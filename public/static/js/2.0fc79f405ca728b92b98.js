webpackJsonp([2],{HXef:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,i,o,s,u,c,l=n("C4MV"),p=n.n(l),d=n("Xxa5"),f=n.n(d),v=n("exGp"),h=n.n(v),b=n("Zx67"),m=n.n(b),k=n("Zrlr"),y=n.n(k),g=n("wxAW"),_=n.n(g),x=n("zwoO"),w=n.n(x),q=n("Pf15"),z=n.n(q),C=n("7+uW"),O=n("443i"),P=n("ipus"),D=n("JaHG"),$=n("wYMm");function j(e,t,n,r){n&&p()(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function U(e,t,n,r,a){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F=(r=Object(O.a)({components:{}}),a=Object(P.b)(function(e){return e.user.user}),i=Object(P.a)("addPhoto"),r((s=function(e){function t(){var e,n,r,a;y()(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r=w()(this,(e=t.__proto__||m()(t)).call.apply(e,[this].concat(o))),j(r,"user",u,r),r.query=D.a.query({qr:null},!0),r.focus=0,r.dragover=0,r.list=[],r.visibility=!1,r.pincode={open:!1,value:"",pin_at:0},j(r,"addPhoto",c,r),a=n,w()(r,a)}return z()(t,e),_()(t,[{key:"onDragOver",value:function(e,t){this.dragover=t,e.preventDefault()}},{key:"onPick",value:function(){var e=this;return D.a.pick("image/*").then(function(t){return e.upload(t)})}},{key:"paste",value:function(){var e=h()(f.a.mark(function e(t){var n,r,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.clipboardData.files,r=0;case 2:if(!(r<n.length)){e.next=9;break}return a=n[r],e.next=6,this.upload(a);case 6:r++,e.next=2;break;case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"drop",value:function(){var e=h()(f.a.mark(function e(t){var n,r,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.dragover=0,t.preventDefault(),n=t.dataTransfer.files,r=0;case 4:if(!(r<n.length)){e.next=11;break}return a=n[r],e.next=8,this.upload(a);case 8:r++,e.next=4;break;case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"upload",value:function(){var e=h()(f.a.mark(function e(t){var n,r,a,i,o,s,u;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof File)){e.next=7;break}return t={name:(n=t).name,url:window.URL.createObjectURL(n),create_at:+new Date,percent:0,data:"",file:n,err:0},this.list.push(t),e.next=6,this.upload(t);case 6:return e.abrupt("return",e.sent);case 7:for(a in(r=new FormData).append("f",t.file),this.query.qr&&r.append("qr",1),this.user)i=this.user[a],r.append(a,i);return e.prev=11,e.next=14,this.$post("file/image",r,{onUploadProgress:function(e){t.percent=e.loaded/e.total*100|0}});case 14:o=e.sent,s=o.data,u=o.url,t.url=u,t.data=s,t.err=0,this.addPhoto(t),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(11),"需要输入验证码"==e.t0&&(this.pincode.open=!0,this.pincode.pin_at=+new Date),t.err=e.t0;case 27:case"end":return e.stop()}},e,this,[[11,23]])}));return function(t){return e.apply(this,arguments)}}()},{key:"copy",value:function(e){D.a.copy(e)?this.$toast.success("复制成功"):this.$toast.error("复制失败")}},{key:"onCode",value:function(){var e=h()(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pincode.value){e.next=5;break}return e.next=3,this.$get("file/code",{username:this.user.username,code:this.pincode.value},{loading:!0});case 3:this.pincode.value="",this.pincode.open=!1;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pin_url",get:function(){return $.a.api+"/api/file/code?username="+(this.user.username||"")+"&t="+this.pincode.pin_at}}]),t}(C.default),u=U(s.prototype,"user",[a],{enumerable:!0,initializer:null}),c=U(s.prototype,"addPhoto",[i],{enumerable:!0,initializer:null}),o=s))||o),M={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("mu-container",{staticClass:"pages-home"},[n("h1",[e._v("上传图片")]),e._v(" "),n("mu-checkbox",{attrs:{label:"识别图中二维码"},model:{value:e.query.qr,callback:function(t){e.$set(e.query,"qr",t)},expression:"query.qr"}}),e._v(" "),n("div",{staticClass:"dropbox"},[n("div",{staticClass:"drop tac",class:{dragover:e.dragover,focus:e.focus},attrs:{tabindex:"0"},on:{focus:function(t){e.focus=1},blur:function(t){e.focus=0},paste:e.paste,dragover:function(t){e.onDragOver(t,1)},dragleave:function(t){e.onDragOver(t,0)},drop:e.drop}},[e.list.length?e._e():n("div",{staticClass:"tip"},[e._v("Paste or Drag & drop files here …")]),e._v(" "),e._l(e.list,function(t,r){return n("div",{key:r,staticClass:"wrapper"},[n("img",{attrs:{src:t.url,alt:t.name}}),e._v(" "),t.percent<100?n("div",{staticClass:"progress",style:{backgroundSize:"100%"+(100-t.percent)+"%"}},[e._v(e._s(t.percent)+"%")]):t.err?n("div",{staticClass:"mask tar"},[n("mu-button",{attrs:{flat:"",color:"error"},on:{click:function(n){e.upload(t)}}},[e._v("重传")])],1):n("div",{staticClass:"mask tar"},[t.data?n("mu-button",{attrs:{flat:"",color:"warning"},on:{click:function(n){e.copy(t.data)}}},[e._v("复制二维码")]):e._e(),e._v(" "),n("mu-button",{attrs:{flat:"",color:"warning"},on:{click:function(n){e.copy(t.url)}}},[e._v("复制链接")])],1)])})],2)]),e._v(" "),n("div",{staticClass:"tar"},[n("mu-button",{attrs:{color:"grey900"},on:{click:e.onPick}},[e._v("选择图片")])],1),e._v(" "),n("mu-dialog",{attrs:{title:"验证码",open:e.pincode.open,"overlay-close":!1},on:{"update:open":function(t){e.$set(e.pincode,"open",t)}}},[n("mu-text-field",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{label:"验证码"},model:{value:e.pincode.value,callback:function(t){e.$set(e.pincode,"value",t)},expression:"pincode.value"}},[n("img",{attrs:{slot:"append",src:e.pin_url,alt:""},slot:"append"})]),e._v(" "),n("mu-button",{attrs:{slot:"actions",color:"primary"},on:{click:e.onCode},slot:"actions"},[e._v("确定")])],1)],1)},staticRenderFns:[]};var R=n("VU/8")(F,M,!1,function(e){n("ba48")},null,null);t.default=R.exports},ba48:function(e,t){}});